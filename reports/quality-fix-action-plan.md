# ä»£ç è´¨é‡ä¿®å¤è¡ŒåŠ¨è®¡åˆ’

**é¡¹ç›®**: tucsenberg-web-frontier  
**è®¡åˆ’åˆ¶å®šæ—¶é—´**: 2025-09-19  
**é¢„è®¡å®Œæˆæ—¶é—´**: 4-6å‘¨

## å¿«é€Ÿä¿®å¤å‘½ä»¤

### ç«‹å³å¯æ‰§è¡Œçš„ä¿®å¤
```bash
# 1. ä¿®å¤æ ¼å¼é—®é¢˜ï¼ˆ30åˆ†é’Ÿï¼‰
pnpm format:write

# 2. è‡ªåŠ¨ä¿®å¤éƒ¨åˆ†ESLinté—®é¢˜ï¼ˆ1å°æ—¶ï¼‰
pnpm lint:fix

# 3. è¿è¡Œç°æœ‰çš„è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬
node scripts/fix-relative-imports.js
node scripts/clean-duplicate-imports.js
node scripts/fix-magic-numbers.js

# 4. é‡æ–°æ£€æŸ¥çŠ¶æ€
pnpm type-check
pnpm lint:check
pnpm format:check
```

## é˜¶æ®µæ€§ä¿®å¤è®¡åˆ’

### ğŸ”´ é˜¶æ®µ1ï¼šç´§æ€¥ä¿®å¤ï¼ˆ1-3å¤©ï¼‰

#### 1.1 æ ¼å¼å’ŒåŸºç¡€è§„èŒƒä¿®å¤
**ç›®æ ‡**: ä¿®å¤æ‰€æœ‰Prettieræ ¼å¼é—®é¢˜å’ŒåŸºç¡€ESLinté”™è¯¯

**æ‰§è¡Œæ­¥éª¤**:
```bash
# ä¿®å¤æ ¼å¼
pnpm format:write

# ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„ESLinté—®é¢˜
pnpm lint:fix

# æ£€æŸ¥ä¿®å¤ç»“æœ
pnpm format:check
pnpm lint:check | head -50  # æŸ¥çœ‹å‰©ä½™é—®é¢˜
```

**é¢„æœŸç»“æœ**:
- Prettieré—®é¢˜: 6 â†’ 0
- ESLintè‡ªåŠ¨ä¿®å¤: ~500ä¸ªè­¦å‘Š

#### 1.2 å…³é”®ESLinté”™è¯¯ä¿®å¤
**ç›®æ ‡**: ä¿®å¤80ä¸ªESLinté”™è¯¯ä¸­çš„é«˜ä¼˜å…ˆçº§é—®é¢˜

**é‡ç‚¹æ–‡ä»¶**:
1. `src/lib/i18n-preloader-core.ts` - ç›¸å¯¹è·¯å¾„å¯¼å…¥
2. `src/types/test-types.ts` - anyç±»å‹ä½¿ç”¨
3. `next.config.ts` - TypeScriptç±»å‹é—®é¢˜
4. `scripts/collect-missing-constants.js` - ä¸å®‰å…¨æ­£åˆ™è¡¨è¾¾å¼

**ä¿®å¤æ¨¡æ¿**:
```typescript
// ä¿®å¤ç›¸å¯¹è·¯å¾„å¯¼å…¥
// é”™è¯¯: import en from '../../messages/en.json'
// æ­£ç¡®: import en from '@/messages/en.json'

// ä¿®å¤anyç±»å‹
// é”™è¯¯: function test(data: any) {}
// æ­£ç¡®: function test(data: unknown) {} æˆ–å…·ä½“ç±»å‹

// ä¿®å¤æœªä½¿ç”¨å˜é‡
// é”™è¯¯: const unused = getValue()
// æ­£ç¡®: const _unused = getValue() æˆ–åˆ é™¤
```

**é¢„æœŸç»“æœ**:
- ESLinté”™è¯¯: 80 â†’ 20-30ä¸ª

### ğŸŸ¡ é˜¶æ®µ2ï¼šæµ‹è¯•ç¨³å®šåŒ–ï¼ˆ1-2å‘¨ï¼‰

#### 2.1 UIç»„ä»¶æµ‹è¯•ä¿®å¤
**ç›®æ ‡**: ä¿®å¤Sheetç»„ä»¶å’Œå…¶ä»–UIç»„ä»¶æµ‹è¯•å¤±è´¥

**ä¸»è¦é—®é¢˜**:
- DialogContentç¼ºå°‘DialogTitle
- å¯è®¿é—®æ€§å±æ€§ç¼ºå¤±
- æµ‹è¯•ç¯å¢ƒé…ç½®é—®é¢˜

**ä¿®å¤ç¤ºä¾‹**:
```tsx
// ä¿®å¤Sheetç»„ä»¶æµ‹è¯•
<SheetContent>
  <SheetTitle>Dialog Title</SheetTitle>  {/* æ·»åŠ å¿…éœ€çš„æ ‡é¢˜ */}
  <SheetDescription>Description</SheetDescription>
  {/* å…¶ä»–å†…å®¹ */}
</SheetContent>
```

**æ‰§è¡Œå‘½ä»¤**:
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pnpm test src/components/ui/__tests__/sheet-basic.test.tsx
pnpm test src/components/ui/__tests__/sheet-accessibility.test.tsx

# è¿è¡Œæ‰€æœ‰UIæµ‹è¯•
pnpm test src/components/ui/
```

#### 2.2 APIè·¯ç”±æµ‹è¯•ä¿®å¤
**ç›®æ ‡**: ä¿®å¤APIæµ‹è¯•ä¸­çš„çŠ¶æ€ç å’Œæ¶ˆæ¯æ ¼å¼ä¸ä¸€è‡´é—®é¢˜

**ä¸»è¦é—®é¢˜**:
- CSPæŠ¥å‘ŠAPIæœŸæœ›204ä½†è¿”å›200
- Turnstile APIæ¶ˆæ¯æ ¼å¼ä¸åŒ¹é…
- é”™è¯¯å¤„ç†é€»è¾‘ä¸ä¸€è‡´

**ä¿®å¤ç­–ç•¥**:
1. ç»Ÿä¸€APIå“åº”æ ¼å¼
2. ä¿®æ­£æµ‹è¯•æœŸæœ›å€¼
3. å®Œå–„é”™è¯¯å¤„ç†

**é¢„æœŸç»“æœ**:
- æµ‹è¯•å¤±è´¥: 661 â†’ 200-300ä¸ª

### ğŸŸ¢ é˜¶æ®µ3ï¼šä»£ç è´¨é‡æå‡ï¼ˆ2-4å‘¨ï¼‰

#### 3.1 ESLintè­¦å‘Šæ¸…ç†
**ç›®æ ‡**: ç³»ç»Ÿæ€§æ¸…ç†2,094ä¸ªESLintè­¦å‘Š

**åˆ†ç±»å¤„ç†**:

1. **Consoleè¯­å¥** (~800ä¸ª)
```bash
# ä½¿ç”¨é¡¹ç›®çš„loggeræ›¿ä»£console
# é”™è¯¯: console.log('debug info')
# æ­£ç¡®: logger.debug('debug info')
```

2. **æœªä½¿ç”¨å˜é‡** (~600ä¸ª)
```bash
# æ‰¹é‡å¤„ç†æœªä½¿ç”¨å˜é‡
node scripts/fix-unused-variables.js
```

3. **é­”æ³•æ•°å­—** (~400ä¸ª)
```bash
# ä½¿ç”¨ç°æœ‰å·¥å…·æå–é­”æ³•æ•°å­—
pnpm codemod:mn:batch
```

4. **å®‰å…¨æ£€æŸ¥** (~294ä¸ª)
```typescript
// ä¿®å¤å¯¹è±¡æ³¨å…¥é—®é¢˜
// é”™è¯¯: obj[userInput]
// æ­£ç¡®: obj[userInput as keyof typeof obj]
```

#### 3.2 æ¶æ„ä¼˜åŒ–
**ç›®æ ‡**: ä¿®å¤7ä¸ªæ¶æ„é”™è¯¯å’Œæ¸…ç†78ä¸ªå­¤ç«‹æ¨¡å—

**è·¨å±‚å¯¼å…¥ä¿®å¤**:
```typescript
// ä¿®å¤env.mjså¯¼å…¥é—®é¢˜
// é”™è¯¯: import { env } from '@/../env.mjs'
// æ­£ç¡®: é€šè¿‡é…ç½®å±‚æˆ–æœåŠ¡å±‚è®¿é—®ç¯å¢ƒå˜é‡
```

**å­¤ç«‹æ¨¡å—æ¸…ç†**:
1. ç¡®è®¤æ¨¡å—ç”¨é€”
2. åˆ é™¤çœŸæ­£æ— ç”¨çš„æ–‡ä»¶
3. æ·»åŠ å¿…è¦çš„å¯¼å‡º/å¯¼å…¥

## è‡ªåŠ¨åŒ–å·¥å…·é…ç½®

### 1. å¢å¼ºé¢„æäº¤é’©å­
```yaml
# .lefthook.yml æ›´æ–°
pre-commit:
  parallel: true
  commands:
    format-fix:
      run: pnpm format:write
      stage_fixed: true
    
    lint-fix:
      run: pnpm lint:fix
      stage_fixed: true
    
    type-check:
      run: pnpm type-check
      fail_text: 'TypeScriptæ£€æŸ¥å¤±è´¥'
    
    test-changed:
      run: pnpm test --changed
      fail_text: 'ç›¸å…³æµ‹è¯•å¤±è´¥'
```

### 2. CI/CDè´¨é‡é—¨ç¦
```yaml
# GitHub Actions è´¨é‡æ£€æŸ¥
quality-gates:
  - name: ESLintæ£€æŸ¥
    run: pnpm lint:check
    fail-fast: true
  
  - name: æµ‹è¯•è¦†ç›–ç‡
    run: pnpm test:coverage
    threshold: 85%
  
  - name: æ„å»ºéªŒè¯
    run: pnpm build:check
```

### 3. å®šæœŸç»´æŠ¤è„šæœ¬
```bash
#!/bin/bash
# scripts/weekly-maintenance.sh

echo "ğŸ§¹ å¼€å§‹æ¯å‘¨ä»£ç ç»´æŠ¤..."

# æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥
echo "æ¸…ç†å¯¼å…¥..."
node scripts/clean-duplicate-imports.js

# ä¿®å¤ç›¸å¯¹è·¯å¾„
echo "ä¿®å¤å¯¼å…¥è·¯å¾„..."
node scripts/fix-relative-imports.js

# æå–é­”æ³•æ•°å­—
echo "å¤„ç†é­”æ³•æ•°å­—..."
pnpm codemod:mn:batch

# æ ¼å¼åŒ–ä»£ç 
echo "æ ¼å¼åŒ–ä»£ç ..."
pnpm format:write

# è¿è¡Œè´¨é‡æ£€æŸ¥
echo "è´¨é‡æ£€æŸ¥..."
pnpm type-check
pnpm lint:check
pnpm test:coverage

echo "âœ… ç»´æŠ¤å®Œæˆï¼"
```

## è¿›åº¦è·Ÿè¸ªæŒ‡æ ‡

### æ¯æ—¥è·Ÿè¸ªæŒ‡æ ‡
```bash
# åˆ›å»ºæ¯æ—¥è´¨é‡æŠ¥å‘Š
pnpm quality:monitor > reports/daily-quality-$(date +%Y%m%d).json
```

### å…³é”®KPIç›®æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | é˜¶æ®µ1ç›®æ ‡ | é˜¶æ®µ2ç›®æ ‡ | æœ€ç»ˆç›®æ ‡ |
|------|--------|-----------|-----------|----------|
| ESLinté”™è¯¯ | 80 | 30 | 10 | 0 |
| ESLintè­¦å‘Š | 2,094 | 1,500 | 800 | <200 |
| æµ‹è¯•å¤±è´¥ | 661 | 400 | 100 | <50 |
| æµ‹è¯•è¦†ç›–ç‡ | 85% | 85% | 88% | 90% |
| æ¶æ„é”™è¯¯ | 7 | 3 | 1 | 0 |

### æ¯å‘¨æ£€æŸ¥æ¸…å•
- [ ] è¿è¡Œå®Œæ•´è´¨é‡æ£€æŸ¥å¥—ä»¶
- [ ] æ›´æ–°è¿›åº¦è·Ÿè¸ªè¡¨
- [ ] è¯†åˆ«æ–°å‡ºç°çš„é—®é¢˜
- [ ] è°ƒæ•´ä¿®å¤ä¼˜å…ˆçº§
- [ ] å›¢é˜Ÿè¿›åº¦åŒæ­¥

## é£é™©å’Œç¼“è§£æªæ–½

### é£é™©1: ä¿®å¤è¿‡ç¨‹ä¸­å¼•å…¥æ–°é—®é¢˜
**ç¼“è§£æªæ–½**:
- å°æ‰¹é‡ä¿®å¤ï¼ŒåŠæ—¶æµ‹è¯•
- ä¿æŒè‰¯å¥½çš„Gitæäº¤å†å²
- æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œå…¨é¢å›å½’æµ‹è¯•

### é£é™©2: æµ‹è¯•ä¿®å¤å·¥ä½œé‡è¶…é¢„æœŸ
**ç¼“è§£æªæ–½**:
- ä¼˜å…ˆä¿®å¤é˜»å¡æ€§æµ‹è¯•
- è€ƒè™‘ä¸´æ—¶è·³è¿‡éå…³é”®æµ‹è¯•
- å¹¶è¡Œè¿›è¡Œæµ‹è¯•ä¿®å¤å’Œæ–°åŠŸèƒ½å¼€å‘

### é£é™©3: å›¢é˜Ÿå¼€å‘æ•ˆç‡å—å½±å“
**ç¼“è§£æªæ–½**:
- åˆ†é˜¶æ®µæ‰§è¡Œï¼Œé¿å…å¤§è§„æ¨¡ä»£ç å†²çª
- æä¾›æ¸…æ™°çš„ä¿®å¤æŒ‡å—å’Œå·¥å…·
- å»ºç«‹ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

## æˆåŠŸæ ‡å‡†

### é˜¶æ®µ1æˆåŠŸæ ‡å‡†
- [ ] Prettieræ ¼å¼é—®é¢˜ = 0
- [ ] ESLinté”™è¯¯ â‰¤ 30ä¸ª
- [ ] æ„å»ºè¿‡ç¨‹æ— è­¦å‘Š
- [ ] åŸºç¡€åŠŸèƒ½æµ‹è¯•é€šè¿‡

### é˜¶æ®µ2æˆåŠŸæ ‡å‡†
- [ ] æµ‹è¯•å¤±è´¥ â‰¤ 100ä¸ª
- [ ] UIç»„ä»¶æµ‹è¯•ç¨³å®š
- [ ] APIæµ‹è¯•é€šè¿‡ç‡ â‰¥ 90%
- [ ] æ ¸å¿ƒåŠŸèƒ½å®Œå…¨å¯ç”¨

### æœ€ç»ˆæˆåŠŸæ ‡å‡†
- [ ] ESLinté”™è¯¯ = 0
- [ ] ESLintè­¦å‘Š â‰¤ 200ä¸ª
- [ ] æµ‹è¯•é€šè¿‡ç‡ â‰¥ 95%
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 90%
- [ ] æ¶æ„è¿è§„ = 0
- [ ] æ„å»ºæ—¶é—´ â‰¤ 30ç§’
- [ ] ä»£ç è´¨é‡è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ** (ä»Šå¤©):
   ```bash
   pnpm format:write
   pnpm lint:fix
   ```

2. **æœ¬å‘¨å†…å®Œæˆ**:
   - ä¿®å¤å…³é”®ESLinté”™è¯¯
   - è®¾ç½®å¢å¼ºçš„é¢„æäº¤é’©å­
   - å¼€å§‹UIç»„ä»¶æµ‹è¯•ä¿®å¤

3. **ä¸‹å‘¨å¼€å§‹**:
   - ç³»ç»Ÿæ€§ä¿®å¤APIæµ‹è¯•
   - å»ºç«‹æ¯æ—¥è´¨é‡ç›‘æ§
   - åˆ¶å®šå›¢é˜Ÿä»£ç è§„èŒƒåŸ¹è®­è®¡åˆ’

é€šè¿‡æ‰§è¡Œè¿™ä¸ªè¡ŒåŠ¨è®¡åˆ’ï¼Œé¡¹ç›®å°†åœ¨4-6å‘¨å†…è¾¾åˆ°ä¼ä¸šçº§ä»£ç è´¨é‡æ ‡å‡†ï¼Œä¸ºåç»­å¼€å‘å’Œç»´æŠ¤å¥ å®šåšå®åŸºç¡€ã€‚
